iot.agile.DeviceManager:

  description: |
    The DeviceManager list the registered devices available from the gateway available protocols.
    This API is responsible to instantiate the reference DBus object for every device
    and offer management and integration points.

  group: Device

  http:
    /devices:
      get:
        operationId: Devices
        tags:
          - DeviceManager
        description: List all registered devices
        responses:
          200:
            description: List the registered device
            schema:
              type: array
              $ref: "#/definitions/DeviceDefinition"
            examples:
              application/json:
                  - deviceId: "bleA1B2C3D4E5F6"
                    address: "A1:B2:C3:D4:E5:F6"
                    name: "MyFirstSensorTag"
                    description: ""
                    protocol : "iot.agile.protocol.ble"
                    path: "/iot/agile/Device/bleA1B2C3D4E5F6"
                    streams:
                      - id: temperature
                        unit: celsius
                      - id: light
                        unit: lumen
                      - id: pressure
                        unit: hPa
                  - deviceId: "bleA6B5C4D3E2F1"
                    address: "A6:B5:C4:D3:E2:F1"
                    name: "MySecondSensorTag"
                    description: ""
                    protocol : "iot.agile.protocol.ble"
                    path: "/iot/agile/Device/bleA6B5C4D3E2F1"
                    streams:
                      - id: temperature
                        unit: celsius
                      - id: light
                        unit: lumen
                      - id: pressure
                        unit: hPa
          204:
            description: Device list is empty
      post:
        operationId: Create
        description: Creates a new device
        tags:
          - DeviceManager
        parameters:
          -
            name: body
            in: body
            description: The request body describing a device
            required: true
            schema:
              $ref: "#/definitions/DeviceDefinition"

        description: Creates a new device definition
        responses:
          200:
            description: Device created
    /devices/{deviceId}:
      parameters:
        -
          name: deviceId
          in: path
          description: Agile device Id
          required: true
          type: string

      get:
        operationId: Read
        description: Get a device definition
        tags:
          - DeviceManager
        responses:
          200:
            description: Device loaded
            schema:
              $ref: "#/definitions/DeviceDefinition"
            examples:
              application/json:
                id: aaa1-bbb2-ccc3-ddd4
                name: SensorTag
                path: iot/agile/device/SensorTag
                streams:
                  - id: temperature
                  - id: accelerometer
          404:
            description: Device not found
      put:
        operationId: Update
        tags:
          - DeviceManager
        parameters:
          -
            name: body
            in: body
            description: The request body describing a device
            required: true
            schema:
              $ref: "#/definitions/DeviceDefinition"
        description: Update a device definition
        responses:
          200:
            description: Device updated
          404:
            description: Device not found
      delete:
        operationId: Delete
        tags:
          - DeviceManager
        parameters:
          -
            name: body
            in: body
            description: The request body describing a device
            required: true
            schema:
              $ref: "#/definitions/DeviceDefinition"
        description: Delete a device definition and unregister it
        responses:
          200:
            description: Device removed
          404:
            description: Device not found

  Devices:
    description: Return all registered devices
    type: Array
    reference: iot.agile.Device
    access: [r, s]
    events:
      - DevicesChanged

  Find:
    description: Search for devices by specific criteria
    args:
      query:
        description: An query object to search for a device
        type: BaseQuery
    return:
      description: A list with all matching registered devices results, eventually sorted and sliced
      type: Array
      reference: iot.agile.Device

  Create:
    description: Create (register) a new device in the manager
    args:
      device:
        type: DeviceDefinition
    return:
      description: Return the AGILE Device ID, unique to identify the device in the gateway
      type: String

  Read:
    description: Load a device definition by its ID
    args:
      Id:
        type: String
    return:
      description: Return the AGILE Device UUID, unique to identify the device in the gateway
      type: DeviceDefinition

  Update:
    description: Updates a device definition by its ID
    args:
      Id:
        type: String
      Definition:
        type: DeviceDefinition
    return: Boolean

  Delete:
    description: Delete a device definition by its ID. This will deactivate the Device DBus object
    args:
      Id:
        type: String
      Definition:
        type: DeviceDefinition
    return: Boolean

  Batch:
    description: Performa a batch operation over a set of devices.
    args:
      operation:
        type: Enum
        fields:
          - Create
          - Update
          - Delete
          - Read
      arguments:
        description: An object to be passed to the underlying function call (Create, Update, Delete, Read)
        type: Object*
    return: Boolean
